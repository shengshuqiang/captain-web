<!-- å€’è®¡æ—¶ç‚¸å¼¹ç»„ä»¶ https://www.17sucai.com/pins/47889.html -->
<template>
    <div class="bomb-box">
        <div id="bomb">
            <div
                ref="flameBox"
                class="flame-box"
            >
                <div
                    class="flame"
                    style="left: 5.51829%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 96.6102%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 15.1658%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 2.8373%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 18.9427%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 88.4761%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 0.589229%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 58.5504%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 33.5581%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 97.37%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 92.6273%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 61.413%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 6.12189%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 99.4008%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 30.3578%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 11.3331%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 6.81252%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 59.029%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 64.9899%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 46.6782%; animation-duration: 1.5s"
                ></div>
                <div
                    class="flame"
                    style="left: 50.9622%; animation-duration: 1.5s"
                ></div>
                <div
                    class="flame"
                    style="left: 31.195%; animation-duration: 1.5s"
                ></div>
                <div
                    class="flame"
                    style="left: 11.1689%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 65.7699%; animation-duration: 1.5s"
                ></div>
                <div
                    class="flame"
                    style="left: 20.1845%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 25.9775%; animation-duration: 1.5s"
                ></div>
                <div
                    class="flame"
                    style="left: 60.517%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 20.666%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 35.5009%; animation-duration: 1.5s"
                ></div>
                <div
                    class="flame"
                    style="left: 65.0609%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 48.0905%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 2.23943%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 43.8782%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 89.7532%; animation-duration: 1.5s"
                ></div>
                <div
                    class="flame"
                    style="left: 58.5036%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 46.0519%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 44.8408%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 61.2655%; animation-duration: 1.5s"
                ></div>
                <div
                    class="flame"
                    style="left: 58.8717%; animation-duration: 1.5s"
                ></div>
                <div
                    class="flame"
                    style="left: 16.0905%; animation-duration: 1.5s"
                ></div>
                <div
                    class="flame"
                    style="left: 64.6442%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 42.2755%; animation-duration: 1.5s"
                ></div>
                <div
                    class="flame"
                    style="left: 23.6023%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 78.2061%; animation-duration: 1.5s"
                ></div>
                <div
                    class="flame"
                    style="left: 28.9879%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 2.92948%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 68.5972%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 76.9592%; animation-duration: 1.5s"
                ></div>
                <div
                    class="flame"
                    style="left: 4.74382%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 92.5846%; animation-duration: 1.5s"
                ></div>
                <div
                    class="flame"
                    style="left: 70.9769%; animation-duration: 1.5s"
                ></div>
                <div
                    class="flame"
                    style="left: 70.664%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 24.9397%; animation-duration: 3s"
                ></div>
                <div
                    class="flame"
                    style="left: 97.841%; animation-duration: 3s"
                ></div>
            </div>
            <div id="time"></div>
        </div>
    </div>
</template>

<script setup lang="ts">
import { deconstructTime } from '../../utils/utils';
const remainingTime = defineModel<number>();

import { ref, watch } from 'vue';
const props = defineProps({
    // çˆ†ç‚¸å€’è®¡æ—¶
    bombTiming: Boolean
});
const emit = defineEmits(['fire']);

const TimeStep: number = 1000 / 12;
const timeHtml = ref('ðŸ”¥ðŸ¤«ðŸ’¥');
const flameBox = ref();

const buildBombTime = (time: number) => {
    let timeHtml;
    if (time > 0) {
        const { mm, ss, ms } = deconstructTime(time);
        timeHtml = `<div class="bomb-mm">${mm}</div><div class="bomb-colon">:</div><div class="bomb-ss">${ss}</div><div class="bomb-colon">:</div><div class="bomb-ms">${ms}</div>`;
    } else {
        timeHtml = 'ðŸ’¥ðŸ’¥ðŸ’¥';
    }
    // console.log('SSU buildBombTime', timeHtml);
    return timeHtml;
};
const addFlame = () => {
    const f = document.createElement('div');
    f.className = 'flame';
    f.style.left = Math.random() * 100 + '%';
    f.style.animationDuration = Math.random() < 0.5 ? '3s' : '1.5s';
    f.onanimationend = () => {
        //   console.log('SSU onanimationend f.remove()')
        f.remove();
    };
    // console.log('SSU flameBox', flameBox)
    if (flameBox.value) {
        flameBox.value.appendChild(f);
    }
};
const startBombTiming = () => {
    const intervalID: any = setInterval(() => {
        addFlame();
        timeHtml.value = buildBombTime(remainingTime.value);
        if (remainingTime.value > TimeStep) {
            remainingTime.value -= TimeStep;
        } else {
            clearInterval(intervalID);
            emit('fire');
        }
    }, TimeStep);
    return intervalID;
};

let intervalID: any = null;
watch(remainingTime, () => {
    // console.log('SSU watch remainingTime', remainingTime);
    timeHtml.value = buildBombTime(remainingTime.value);
});
watch(
    () => props.bombTiming,
    bombTiming => {
        if (intervalID) {
            clearInterval(intervalID);
        }
        if (bombTiming) {
            intervalID = startBombTiming();
        }
    },
    { immediate: true }
);
watch(timeHtml, timeHtml => {
    // console.log('SSU watch timeHtml', timeHtml);
    document.querySelector('#time').innerHTML = `${timeHtml}`;
});
</script>

<style>
.bomb-mm {
    width: 0.8rem;
    text-align: center;
}

.bomb-ss {
    width: 0.8rem;
    text-align: center;
}

.bomb-ms {
    width: 1.2rem;
    text-align: center;
}
.bomb-box {
    width: 3rem;
    height: 3rem;
    padding: 0.3rem;
    margin-top: 0.8rem;
    position: relative;
}
.bomb-box::after {
    content: '';
    width: 3rem;
    height: 0.5rem;
    background: rgba(0, 0, 0, 0.5);
    position: absolute;
    left: 0.35rem;
    bottom: 0.28rem;
    border-radius: 50%;
    transform: translate(-25%, 25%);
    filter: blur(0.07rem);
    z-index: -1;
}
.bomb-colon {
    padding-bottom: 0.1rem;
    text-align: center;
}

:root {
    --fire-width: 0.5rem;
    --fire-blur: 0;
    --fire-blur: calc(var(--fire-width) * 0.03);
    --color-start: orangered;
    --color-end: yellow;
}

#bomb {
    width: 3rem;
    height: 3rem;
    border-radius: 50%;
    background: radial-gradient(circle at 66% 33%, #555, black 50%);
    position: relative;
    display: grid;
    place-items: center;
    box-shadow: -0.05rem 0.05rem 0.15rem rgba(0, 0, 0, 0.5);
}

#bomb::before {
    content: '';
    width: 0.1rem;
    height: 1rem;
    background: linear-gradient(to bottom right, #630 40%, peru 48%, peru 52%, #630 60%);
    background-size: 0.1rem 0.1rem;
    border-radius: 0.15rem 0.15rem 0 0;
    position: absolute;
    left: 100%;
    top: -8.5%;
    transform: rotate(50deg);
    z-index: -1;
}

#bomb::after {
    content: '';
    width: 1rem;
    height: 1rem;
    background: linear-gradient(to top, black, #222);
    border-radius: 0.15rem 0.15rem 0 0;
    position: absolute;
    left: 75%;
    top: 0;
    transform: rotate(50deg);
    z-index: -1;
    box-shadow: 0.05rem 0.05rem 0.1rem rgba(0, 0, 0, 0.5);
}

#time {
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: system-ui, sans-serif;
    color: white;
    text-align: center;
    font-size: 0.48rem;
    letter-spacing: 0.03rem;
    line-height: 100%;
}

#time span {
    font-size: 0.2rem !important;
    display: block;
    margin: 1.25rem 0;
    font-weight: 100;
    padding: 1.25rem 0;
    letter-spacing: 0.01rem;
}

#time span:nth-child(1) {
    border-bottom: 0.01rem solid gray;
}

#time span:nth-child(2) {
    border-top: 0.01rem solid gray;
}

.flame-box {
    width: 0.4rem;
    height: 0.5rem;
    position: absolute;
    left: 107%;
    top: -16.5%;
    border-radius: 0 0 100% 100%;
    overflow: hidden;
    border-radius: 50% / 40% 40% 60% 60%;
}

.flame {
    width: calc(var(--fire-width) * 0.2);
    height: calc(var(--fire-width) * 0.2);
    border-radius: 50%;
    background: var(--color-start);
    position: absolute;
    bottom: 0;
    transform: translateX(-50%);
    filter: blur(var(--fire-blur));
    animation: burn 1.5s ease-in forwards;
}

@keyframes burn {
    0% {
        opacity: 0;
    }

    10% {
        opacity: 1;
    }

    100% {
        background: var(--color-end);
        bottom: calc(var(--fire-width) * 0.75);
        opacity: 0;
        transform: translateX(-50%) scale(0.2);
    }
}
</style>
